DROP TABLE IF EXISTS person CASCADE;
DROP TABLE IF EXISTS instrument_rental CASCADE;
DROP TABLE IF EXISTS rental_price_history CASCADE;
DROP TABLE IF EXISTS instrument CASCADE;
DROP TABLE IF EXISTS student CASCADE;
DROP TABLE IF EXISTS system_config CASCADE;

-- Create the person table
CREATE TABLE person (
    person_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    person_number CHAR(12) NOT NULL UNIQUE,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL
);


CREATE TABLE student (
    student_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    person_id INT NOT NULL,
    skill_level VARCHAR(100),
    FOREIGN KEY (person_id) REFERENCES person(person_id) ON DELETE CASCADE
);


-- Create the system_config table
CREATE TABLE system_config (
    config_type VARCHAR(50) NOT NULL PRIMARY KEY,
    config_value INT NOT NULL
);

-- Insert default system constraints
INSERT INTO system_config (config_type, config_value)
VALUES
    ('max_rental_duration_months', 12),
    ('max_active_rentals_per_student', 2);


-- Create the instrument table
CREATE TABLE instrument (
    instrument_id VARCHAR(50) NOT NULL PRIMARY KEY,
    instrument_type VARCHAR(100) NOT NULL,
    instrument_brand VARCHAR(100) NOT NULL,
    available_stock INT NOT NULL
);

-- Create the rental_price_history table
CREATE TABLE rental_price_history (
    rental_price_id VARCHAR(50) NOT NULL PRIMARY KEY,
    instrument_id VARCHAR(50) NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    is_current BOOLEAN NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (instrument_id) REFERENCES instrument(instrument_id) ON DELETE CASCADE
);

-- Create the instrument_rental table
CREATE TABLE instrument_rental (
    rental_id VARCHAR(100) NOT NULL PRIMARY KEY,
    rental_start_time TIMESTAMP NOT NULL,
    lease_expiry_time TIMESTAMP NOT NULL,
    rental_price_id VARCHAR(50) NOT NULL,
    instrument_id VARCHAR(50) NOT NULL,
    student_id INT NOT NULL,
    FOREIGN KEY (rental_price_id) REFERENCES rental_price_history(rental_price_id) ON DELETE CASCADE,
    FOREIGN KEY (instrument_id) REFERENCES instrument(instrument_id) ON DELETE CASCADE,
    FOREIGN KEY (student_id) REFERENCES student(student_id) ON DELETE CASCADE
);


-- Insert data into person table (studenter)
INSERT INTO person (person_id, person_number, first_name, last_name)
VALUES 
(1, '123456789012', 'Anna', 'Karlsson'),
(2, '234567890123', 'Erik', 'Svensson'),
(3, '345678901234', 'Lisa', 'Nilsson'),
(4, '456789012345', 'John', 'Doe'),
(5, '567890123456', 'Emily', 'Smith'),
(6, '678901234567', 'Michael', 'Johnson'),
(7, '789012345678', 'Emma', 'Brown'),
(8, '890123456789', 'Sophia', 'Williams'),
(22, '243890458989', 'Carl', 'Andersson'),
(23, '014789345678', 'Eva', 'Brown'),
(24, '123123129012', 'Ludde', 'Williams'),
(25, '245890558989', 'Luva', 'Andersson'),
(26, '123890356789', 'Lase', 'Williams'),
(27, '243890235898', 'Laos', 'Andersson'),
(28, '014789321568', 'Penny', 'Brown'),
(29, '121890458789', 'Sara', 'Williams'),
(30, '245890458989', 'Sandra', 'Andersson'),
(31, '123890344789', 'Lukas', 'Williams'),
(32, '243890234898', 'Lucas', 'Andersson'),
(33, '014789356568', 'Viktor', 'Brown'),
(34, '121890467789', 'Jay', 'Williams'),
(35, '245890489989', 'Jayce', 'Andersson'),
(36, '153333227948', 'Harry', 'Potter');

-- Insert data into student table

INSERT INTO student (student_id, person_id, skill_level)
VALUES 
(1, 1, 'beginner'),
(2, 2, 'intermediate'),
(3, 3, 'advanced'),
(4, 4, 'beginner'),
(5, 5, 'intermediate'),
(6, 6, 'advanced'),
(7, 7, 'beginner'),
(8, 8, 'advanced'),
(9, 22, 'beginner'),
(10, 23, 'intermediate'),
(11, 24, 'beginner'),
(12, 25, 'advanced'),
(13, 26, 'beginner'),
(14, 27, 'intermediate'),
(15, 28, 'advanced'),
(16, 29, 'beginner'),
(17, 30, 'beginner'),
(18, 31, 'intermediate'),
(19, 32, 'advanced'),
(20, 33, 'intermediate'),
(21, 34, 'beginner'),
(22, 35, 'advanced'),
(23, 36, 'intermediate');
	-- Insert data into instrument table
INSERT INTO instrument (instrument_id, instrument_type, instrument_brand, available_stock)
VALUES
('INSTR001', 'Guitar', 'Yamaha', 5),
('INSTR002', 'Piano', 'Roland', 3),
('INSTR003', 'Violin', 'Stradivarius', 2),
('INSTR004', 'Drum', 'Pearl', 4),
('INSTR005', 'Flute', 'Yamaha', 6);

-- Insert data into rental_price_history table
INSERT INTO rental_price_history (rental_price_id, instrument_id, start_date, end_date, is_current, price)
VALUES
('RP001', 'INSTR001', '2023-01-01', '2023-12-31', TRUE, 100.00),
('RP002', 'INSTR002', '2023-01-01', '2023-12-31', TRUE, 120.00),
('RP003', 'INSTR003', '2023-02-01', '2023-12-31', TRUE, 150.00),
('RP004', 'INSTR004', '2023-03-01', '2023-12-31', TRUE, 180.00),
('RP005', 'INSTR005', '2023-04-01', '2023-12-31', TRUE, 200.00);

-- Insert data into instrument_rental table
INSERT INTO instrument_rental (rental_id, rental_start_time, lease_expiry_time, rental_price_id, instrument_id, student_id)
VALUES
('R001', '2023-11-20 10:00:00', '2023-12-20 10:00:00', 'RP001', 'INSTR001', 1),
('R002', '2023-11-21 10:00:00', '2023-12-21 10:00:00', 'RP002', 'INSTR002', 2);
